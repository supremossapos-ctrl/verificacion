<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>STREETZ FARMZ — Authenticity</title>
  <meta name="theme-color" content="#0b0b0f"/>

  <style>
    :root{
      --bg:#07070a;
      --text:#f4f4ff;
      --muted:#b9b9d0;

      --orange:#ff8a00;
      --orange2:#ffb000;

      --blue:#21b8ff;
      --blue2:#0066ff;

      --good:#46ff9a;
      --bad:#ff3b5c;

      --accent:#ff8a00;
      --shadow: 0 18px 60px rgba(0,0,0,.65);
      --border: 1px solid rgba(255,138,0,.35);
      --radius: 18px;

      /* safe padding so nothing touches the border */
      --safePad: 14px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1000px 600px at 20% 10%, rgba(33,184,255,.10), transparent 60%),
        radial-gradient(900px 500px at 80% 30%, rgba(255,138,0,.10), transparent 65%),
        radial-gradient(700px 400px at 50% 95%, rgba(0,102,255,.10), transparent 55%),
        linear-gradient(180deg, var(--bg), #05050a 60%, #030308);
      overflow-x:hidden;
    }

    .grain{
      pointer-events:none;
      position:fixed; inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.25'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
      opacity:.22;
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px 16px;
    }

    .shell{
      width:min(880px, 100%);
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:14px;
    }

    @media (max-width: 880px){
      .shell{grid-template-columns:1fr}
    }

    .card{
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: var(--border);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(600px 240px at 20% 0%, rgba(255,138,0,.35), transparent 60%),
                  radial-gradient(540px 240px at 90% 30%, rgba(33,184,255,.30), transparent 55%);
      filter: blur(14px);
      opacity:.35;
      z-index:0;
    }
    .card > *{position:relative; z-index:1}

    .header{
      padding:18px 18px 14px 18px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      background: linear-gradient(180deg, rgba(10,10,16,.88), rgba(10,10,16,.55));
    }

    .brand{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;

      /* IMPORTANT: keep content inside orange border */
      padding-right: var(--safePad);
    }

    .logo{
      line-height:1;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-width: 0;
    }

    .logo img{
      width: min(360px, 72vw);
      height:auto;
      display:block;
      filter: drop-shadow(0 12px 26px rgba(0,0,0,.55));
    }

    .logo .sub{
      margin-top:2px;
      font-size:13px;
      color:var(--muted);
      letter-spacing:.18em;
      text-transform:uppercase;
    }

    /* BADGE (Authentic) - must never overflow */
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.35);
      font-weight:700;
      font-size:12px;
      color: rgba(255,255,255,.92);

      white-space:nowrap;
      max-width: 220px;
      overflow:hidden;
      text-overflow:ellipsis;

      flex-shrink:0;              /* do not collapse weirdly */
      margin-right: 2px;          /* tiny buffer */
    }

    .dot{
      width:10px;height:10px;border-radius:50%;
      background: rgba(255,255,255,.35);
      box-shadow: 0 0 16px rgba(255,255,255,.18);
      flex: 0 0 auto;
    }

    .main{
      padding:18px;
      background: linear-gradient(180deg, rgba(10,10,16,.45), rgba(10,10,16,.15));

      /* keep inside border on the right */
      padding-right: calc(18px + var(--safePad));
    }

    .quality{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:14px 14px;
      border-radius: 14px;
      background:
        radial-gradient(420px 160px at 15% 20%, rgba(33,184,255,.18), transparent 60%),
        radial-gradient(420px 160px at 85% 30%, rgba(255,138,0,.18), transparent 60%),
        rgba(0,0,0,.32);
      border: 1px solid rgba(255,255,255,.08);

      min-width:0; /* prevent overflow */
    }

    .q-lettering{
      display:block;
      width: min(420px, 70vw);
      height:auto;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.55));
    }

    .pill{
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:800;
      letter-spacing:.08em;
      text-transform:uppercase;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.35);
      color: rgba(255,255,255,.88);
      white-space:nowrap;

      /* HARD LIMIT so it never goes outside border */
      max-width: 95%;
      overflow:hidden;
      text-overflow:ellipsis;

      flex: 0 0 auto;
    }

    .status{
      margin-top:14px;
      padding:16px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.33);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .status .big{
      font-size:34px;
      font-weight:950;
      letter-spacing:.5px;
      text-transform:uppercase;
    }
    .status .hint{
      text-align:right;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
      max-width: 260px;
    }

    .meta{
      margin-top:14px;
      padding:14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.26);
      color: rgba(255,255,255,.88);
      line-height:1.55;
      font-size:14px;

      /* if code is long, scroll instead of wrapping */
      overflow-x:auto;
    }

    .meta code{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      padding:2px 7px;
      border-radius:8px;
      color:#fff;
      font-weight:800;

      white-space:nowrap;
      word-break:keep-all;
      display:inline-block;
    }

    .side{
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:14px;

      padding-right: calc(18px + var(--safePad));
    }

    .sidebox{
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.28);
      padding:14px;
    }

    .sidebox h3{
      margin:0 0 8px 0;
      font-size:14px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color: rgba(255,255,255,.90);
    }

    .sidebox p{
      margin:0;
      color: var(--muted);
      font-size:13px;
      line-height:1.55;
    }

    .footer{
      margin-top:auto;
      color: rgba(255,255,255,.35);
      font-size:12px;
      text-align:center;
      padding-top:6px;
    }

    .good{ color: var(--good); text-shadow: 0 0 16px rgba(70,255,154,.15); }
    .bad { color: var(--bad);  text-shadow: 0 0 16px rgba(255,59,92,.12); }
    .warn{ color: var(--orange2); text-shadow: 0 0 16px rgba(255,176,0,.12); }

    .accent-ring{
      position:absolute; inset:-1px;
      border-radius: var(--radius);
      pointer-events:none;
      background: conic-gradient(from 180deg, rgba(255,138,0,.0), rgba(255,138,0,.30), rgba(33,184,255,.25), rgba(255,138,0,.0));
      mask: linear-gradient(#000, #000) content-box, linear-gradient(#000, #000);
      -webkit-mask: linear-gradient(#000, #000) content-box, linear-gradient(#000, #000);
      padding:1px;
      opacity:.35;
    }

    /* MOBILE: make sure nothing gets clipped */
    @media (max-width: 520px){
      :root{ --safePad: 18px; }

      .header{
        padding-right: calc(18px + var(--safePad));
      }

      .brand{
        flex-wrap:wrap;
        gap:10px;
      }

      .badge{
        max-width: 100%;
        align-self:flex-start;
      }

      .logo img{
        width: min(300px, 80vw);
      }

      .quality{
        flex-direction:column;
        align-items:flex-start;
      }

      .pill{
        align-self:flex-end;
      }
    }
  </style>
</head>

<body>
  <div class="grain"></div>

  <div class="wrap">
    <div class="shell">

      <!-- MAIN CARD -->
      <div class="card">
        <div class="accent-ring"></div>

        <div class="header">
          <div class="brand">
            <div class="logo">
              <img id="brandTitleImg"
                   src="assets/qualities/STREETZFARM_LETTERING_BLANCO.png"
                   alt="STREETZ FARMZ">
              <div class="sub">AUTHENTICITY CHECK</div>
            </div>

            <div class="badge">
              <span class="dot" id="dot"></span>
              <span id="badgeText">Scanning…</span>
            </div>
          </div>
        </div>

        <div class="main">
          <div class="quality">
            <div>
              <img id="qualityLetteringImg" class="q-lettering" alt="Quality">
              <div style="margin-top:10px;color:var(--muted);font-size:13px;" id="qualityDesc">Verification in progress…</div>
            </div>
            <div class="pill" id="pill">QUALITY</div>
          </div>

          <div class="status">
            <div class="big warn" id="statusText">CHECKING</div>
            <div class="hint" id="statusHint">
              Keep this page open.<br/>We are verifying the QR signature.
            </div>
          </div>

          <div class="meta" id="meta">
            Loading details…
          </div>
        </div>
      </div>

      <!-- SIDE PANEL -->
      <div class="card">
        <div class="accent-ring"></div>
        <div class="side">
          <div class="sidebox">
            <h3>How it works</h3>
            <p>
              Each unit has a unique QR code containing a cryptographic signature.
              If the signature is valid, the product is marked as <b>AUTHENTIC</b>.
            </p>
          </div>

          <div class="sidebox">
            <h3>Warning</h3>
            <p>
              If you see <b>FAKE</b> or the page looks modified, do not trust the product.
              Take a screenshot and contact the seller.
            </p>
          </div>

          <div class="sidebox">
            <h3>Tip</h3>
            <p>
              If your phone opens a different domain than <b>streetz-farmz.github.io</b>,
              the QR may be cloned.
            </p>
          </div>

          <div class="footer">© STREETZ FARMZ — Verification Page</div>
        </div>
      </div>

    </div>
  </div>

<script>
const PUBLIC_KEY_PEM = `-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAugMJ76e+l3g7DepjOdzE
S0FKgnaWM7jlSsUfCjqNUz6qHxmurZfOiPreHywxy5jodZyR96ZZf631PqK6UUai
zMG2xMf8YpB4Qljo5vmrI5Pw4pJpIxmevAe9/YhoJImQI8hJcqmWw9mgiYGs4Yk2
uUjKgPud5NUVE5rv17a3OHbv+oOLTH120VsTT+VPs2jcFTXXiXDSiWmza6IXGkhk
38/yGrGh4FKrOBJ57Dk9O2RwnR98wu5zF7hhKOQHbzOEnZFq0kk00gn/GHGrfJwY
rfBeLL6n3Bdr3UKwmBL5S7xE/W33A9JW5gt3+no2waQFsTwDahorjLIzJ4nHsSeV
8wIDAQAB
-----END PUBLIC KEY-----`;

function q(name){ return new URL(location.href).searchParams.get(name) || ""; }

function b64urlToBytes(b64url){
  const b64 = b64url.replace(/-/g,"+").replace(/_/g,"/") + "===".slice((b64url.length + 3) % 4);
  const bin = atob(b64);
  const bytes = new Uint8Array(bin.length);
  for(let i=0;i<bin.length;i++) bytes[i]=bin.charCodeAt(i);
  return bytes;
}

function pemToArrayBuffer(pem){
  const b64 = pem.replace(/-----.*-----/g,"").replace(/\s+/g,"");
  const bin = atob(b64);
  const bytes = new Uint8Array(bin.length);
  for(let i=0;i<bin.length;i++) bytes[i]=bin.charCodeAt(i);
  return bytes.buffer;
}

function setBadge(text, color){
  document.getElementById("badgeText").textContent = text;
  const dot = document.getElementById("dot");
  dot.style.background = color;
  dot.style.boxShadow = 0 0 16px ${color}55;
}

function normQuality(s){
  return (s || "").toLowerCase().replace(/[^a-z0-9]+/g, " ").trim();
}

function qualityLetteringPath(quality){
  const key = normQuality(quality);
  const MAP = {
    "drysift": "assets/qualities/LETTERING_STREETZFARMZ_DRYSIFT.png",
    "premium drysift": "assets/qualities/LETTERING_STREETZFARMZ_PREMIUM_DRYSIFT.png",

    "frozen": "assets/qualities/LETTERING_STREETZFARMZ_FROZEN_.png",
    "premium frozen": "assets/qualities/LETTERING_STREETZFARMZ_PREMIUM_FROZEN_.png",

    "static": "assets/qualities/LETTERING_STREETZFARMZ_STATIC.png",
    "premium static": "assets/qualities/LETTERING_STREETZFARMZ_PREMIUM_STATIC_.png",

    "fresh frozen static": "assets/qualities/LETTERING_STREETZFARMZ_FFSTATIC.png",
    "premium fresh frozen static": "assets/qualities/LETTERING_STREETZFARMZ_PREMIUM_FFSTATIC.png"
  };
  return MAP[key] || "assets/qualities/STREETZFARM_LETTERING_BLANCO.png";
}

function qualityTheme(quality){
  const qq = (quality || "").toLowerCase();

  if(qq.includes("premium") && qq.includes("frozen")) return { pill:"PREMIUM FROZEN", desc:"Premium frozen selection", color:"#21b8ff" };
  if(qq.includes("frozen")) return { pill:"FROZEN", desc:"Cold-cured selection", color:"#21b8ff" };

  if(qq.includes("premium") && qq.includes("drysift")) return { pill:"PREMIUM DRYSIFT", desc:"Premium dry sift refinement", color:"#d6d6e8" };
  if(qq.includes("drysift")) return { pill:"DRYSIFT", desc:"Dry sift refinement", color:"#d6d6e8" };

  if(qq.includes("premium") && qq.includes("fresh") && qq.includes("static")) return { pill:"PREMIUM FF STATIC", desc:"Premium fresh frozen static", color:"#00d1ff" };
  if(qq.includes("fresh") && qq.includes("static")) return { pill:"FF STATIC", desc:"Fresh frozen static", color:"#00d1ff" };

  if(qq.includes("premium") && qq.includes("static")) return { pill:"PREMIUM STATIC", desc:"Premium static refinement", color:"#0066ff" };
  if(qq.includes("static")) return { pill:"STATIC", desc:"Electro refined texture", color:"#0066ff" };

  return { pill:"QUALITY", desc:"Signature-linked unit", color:"#ff8a00" };
}

async function run(){
  const code = q("c").trim();
  const brand = q("m").trim();
  const quality = q("p").trim();
  const batch = q("l").trim();
  const sig = q("s").trim();

  const statusText = document.getElementById("statusText");
  const statusHint = document.getElementById("statusHint");
  const meta = document.getElementById("meta");
  const qualityDesc = document.getElementById("qualityDesc");
  const pill = document.getElementById("pill");

  const brandImg = document.getElementById("brandTitleImg");
  if (brandImg) brandImg.src = "assets/qualities/STREETZFARM_LETTERING_BLANCO.png";

  const qImg = document.getElementById("qualityLetteringImg");
  if (qImg) qImg.src = qualityLetteringPath(quality);

  const th = qualityTheme(quality);
  qualityDesc.textContent = th.desc;
  pill.textContent = th.pill;

  setBadge("Checking signature…", th.color);

  if(!code || !sig){
    statusText.textContent = "FAKE";
    statusText.className = "big bad";
    statusHint.innerHTML = "Missing parameters in the QR link.";
    setBadge("Invalid QR link", "#ff3b5c");
    meta.innerHTML = This QR does not contain the required verification data.;
    return;
  }

  const msg = ${code}|${brand}|${quality}|${batch};

  try{
    const key = await crypto.subtle.importKey(
      "spki",
      pemToArrayBuffer(PUBLIC_KEY_PEM),
      { name:"RSA-PSS", hash:"SHA-256" },
      false,
      ["verify"]
    );

    const ok = await crypto.subtle.verify(
      { name:"RSA-PSS", saltLength:32 },
      key,
      b64urlToBytes(sig),
      new TextEncoder().encode(msg)
    );

    if(ok){
      statusText.textContent = "AUTHENTIC";
      statusText.className = "big good";
      statusHint.innerHTML = "Signature verified successfully.";
      setBadge("Authentic", "#46ff9a");

      meta.innerHTML =
        Code: <code>${code}</code><br> +
        Brand: <b>${brand || "—"}</b><br> +
        Quality: <b>${quality || "—"}</b><br> +
        Batch: <b>${batch || "—"}</b>;
    }else{
      statusText.textContent = "FAKE";
      statusText.className = "big bad";
      statusHint.innerHTML = "Signature mismatch.";
      setBadge("Fake", "#ff3b5c");
      meta.innerHTML =
        This QR signature is not valid.<br> +
        Do not trust this product.;
    }

  }catch(e){
    statusText.textContent = "ERROR";
    statusText.className = "big warn";
    statusHint.innerHTML = "Verification failed.";
    setBadge("Error", "#ffb000");
    meta.innerHTML =
      Your browser could not verify the signature.<br> +
      Most common reason: the public key was not pasted correctly into verify.html.;
  }
}

run();
</script>
</body>
</html>
